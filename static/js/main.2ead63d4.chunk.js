(this.webpackJsonpbattleship=this.webpackJsonpbattleship||[]).push([[0],{15:function(t,e,i){"use strict";i.r(e);var a=i(3),n=i.n(a),r=i(9),s=i.n(r),o=i(1),c=i(2),h=i(4),l=i(6),u=i(5),p=i(7),d=function(){function t(e,i){Object(o.a)(this,t),this.sections=[],this.size=e,this.name=i;for(var a=0;a<e;a++)this.sections.push(!1)}return Object(c.a)(t,[{key:"hit",value:function(t){this.sections[t]=!0,this.isSunk()&&this.onSunk()}},{key:"isSunk",value:function(){return this.sections.reduce((function(t,e){return t&&e}))}}]),t}(),v=function(){return new d(2,"PT BOAT")},g=function(){return new d(3,"SUBMARINE")},S=function(){return new d(3,"DESTROYER")},f=function(){return new d(4,"BATTLESHIP")},b=function(){return new d(5,"CARRIER")},m=function(){function t(){Object(o.a)(this,t),this.hitState=0}return Object(c.a)(t,[{key:"addHitListener",value:function(t){this.onHitCallback=t}},{key:"onHit",value:function(){this.containsShip()?(this.hitState=1,this.onHitCallback()):this.hitState=2}},{key:"onSunk",value:function(){this.hitState=4}},{key:"containsShip",value:function(){return this.onHitCallback}}]),t}(),j=10,k=j,y=function(){function t(){Object(o.a)(this,t),this.spaces=[],this.ships=[],this.shipSunkListeners=[];for(var e=0;e<j;e++)for(var i=0;i<k;i++)this.spaces.push(new m)}return Object(c.a)(t,[{key:"checkShipPlacement",value:function(t,e,i,a){var n=[],r=t;t<0?r=0:t>=k&&(r=9);var s=e;e<0?s=0:t>=j&&(s=9);var o=0,c=0;switch(a){case 2:r+(o=1)*(i-1)>=k&&(r=k-i);break;case 3:s+(c=-1)*(i-1)<0&&(s=j+(i-1));break;case 1:s+(c=1)*(i-1)>=j&&(s=j-i);break;default:r+(o=-1)*(i-1)<0&&(r=i-1)}for(var h=!0,l=0;l<i;l++){var u=r+l*o,p=s+l*c,d=this.getSpace(u,p);if(d&&d.onHitCallback&&(h=!1,n=n.concat({row:u,col:p,hasShip:!0})),!d)return{shipSpaces:[],validPlacement:!1};n=n.concat({row:u,col:p,hasShip:!1})}return{shipSpaces:n,validPlacement:h}}},{key:"tryPlaceShip",value:function(t,e,i,a){var n=i((function(){return!1})),r=n.size,s=this.checkShipPlacement(t,e,r,a);return s.validPlacement&&this.addShip(n,s.shipSpaces),s.validPlacement}},{key:"addShip",value:function(t,e){var i=this;t.onSunk=function(){e.forEach((function(t){var e=t.row,a=t.col;i.sinkSpace(e,a)}));var a=Object.assign(i);i.shipSunk(t.name),i.updateCallback(a)},e.forEach((function(e,a){var n=e.row,r=e.col,s=i.getSpace(n,r);if(s.onHitCallback)throw new Error("Tried to place ships on top of each other! Row: ".concat(n,", Col: ").concat(r));s.addHitListener((function(){t.hit(a)}))})),this.ships.push(t);var a=Object.assign(this);return a.ships.push(t),this.updateCallback&&this.updateCallback(a),a}},{key:"getSpace",value:function(t,e){return this.spaces[t*j+e]}},{key:"recieveAttack",value:function(t,e){this.getSpace(t,e).onHit();var i=Object.assign(this);return this.updateCallback(i),i}},{key:"sinkSpace",value:function(t,e){this.getSpace(t,e).onSunk()}},{key:"allShipsSunk",value:function(){return this.ships.reduce((function(t,e){return t&&e.isSunk()}),!0)}},{key:"shipSunk",value:function(t){console.log("Sunk ".concat(t)),this.shipSunkListeners.forEach((function(e){return e(t)}))}},{key:"addShipSunkListener",value:function(t){this.shipSunkListeners.push(t)}}]),t}(),x=function(){function t(e){Object(o.a)(this,t),this.opposingBoard=e,this.nextMoves=[],this.hits=[],this.shipsRemaining={"PT BOAT":2,SUBMARINE:3,DESTROYER:3,BATTLESHIP:4,CARRIER:5},this.determineMinShipSize(),this.onShipSunk=this.onShipSunk.bind(this),e.addShipSunkListener(this.onShipSunk)}return Object(c.a)(t,[{key:"determineMinShipSize",value:function(){var t=this;Object.keys(this.shipsRemaining).length&&(this.minShipSize=Object.keys(this.shipsRemaining).map((function(e){return t.shipsRemaining[e]})).reduce((function(t,e){return e<t?e:t})))}},{key:"onShipSunk",value:function(t){var e=this,i=this.shipsRemaining[t];delete this.shipsRemaining[t],i===this.minShipSize&&this.determineMinShipSize(),this.hits=this.hits.filter((function(t){var i=t.row,a=t.col;return 4!==e.opposingBoard.getSpace(i,a).hitState})),this.nextMoves=[]}},{key:"makeMove",value:function(){var t;if(this.hits.length){this.destroy();do{var e=Math.round(Math.random()*(this.nextMoves.length-1));t=this.nextMoves.splice(e,1)[0]}while(0!==this.opposingBoard.getSpace(t.row,t.col).hitState)}else t=this.search();return this.opposingBoard.recieveAttack(t.row,t.col),1===this.opposingBoard.getSpace(t.row,t.col).hitState?(this.hits.push(t),!0):4===this.opposingBoard.getSpace(t.row,t.col).hitState}},{key:"verticalLength",value:function(t,e){for(var i=t,a=this.opposingBoard.getSpace(i,e);i-1>=0&&(0===a.hitState||1===a.hitState);)i-=1,a=this.opposingBoard.getSpace(i,e);var n=t;for(a=this.opposingBoard.getSpace(n,e);n+1<k&&(0===a.hitState||1===a.hitState);)n+=1,a=this.opposingBoard.getSpace(n,e);return n-i+1}},{key:"horizontalLength",value:function(t,e){for(var i=e,a=this.opposingBoard.getSpace(t,i);i-1>=0&&(0===a.hitState||1===a.hitState);)i-=1,a=this.opposingBoard.getSpace(t,i);var n=e;for(a=this.opposingBoard.getSpace(t,n);n+1<j&&(0===a.hitState||1===a.hitState);)n+=1,a=this.opposingBoard.getSpace(t,n);return n-i+1}},{key:"canShipFitHere",value:function(t,e){if(t<0||t>=k||e<0||e>=j)return!1;var i=this.verticalLength(t,e)>=this.minShipSize,a=this.horizontalLength(t,e)>=this.minShipSize;return i||a}},{key:"search",value:function(){var t,e;do{t=Math.round(9*Math.random()),e=Math.round(9*Math.random())}while(0!==this.opposingBoard.getSpace(t,e).hitState&&!this.canShipFitHere(t,e));return{row:t,col:e}}},{key:"validateSpaces",value:function(t){var e=this;return t.filter((function(t){var i=t.row,a=t.col;return i>=0&&i<k&&a>=0&&a<j&&0===e.opposingBoard.getSpace(i,a).hitState}))}},{key:"searchAlongColumn",value:function(t){for(var e=t.row,i=t.row,a=t.col;e<k&&1===this.opposingBoard.getSpace(e,a).hitState;)e++;for(;i>=0&&1===this.opposingBoard.getSpace(i,a).hitState;)i--;return this.validateSpaces([{row:e,col:a},{row:i,col:a}])}},{key:"searchAlongRow",value:function(t){for(var e=t.col,i=t.col,a=t.row;e<j&&1===this.opposingBoard.getSpace(a,e).hitState;)e++;for(;i>=0&&1===this.opposingBoard.getSpace(a,i).hitState;)i--;return this.validateSpaces([{row:a,col:e},{row:a,col:i}])}},{key:"destroy",value:function(){var t=this;if(1===this.hits.length){var e=this.hits[0],i=[[1,0],[0,-1],[0,1],[-1,0]].map((function(t){var i=Object(p.a)(t,2),a=i[0],n=i[1];return{row:e.row+a,col:e.col+n}})).filter((function(e){var i=e.row,a=e.col;return t.canShipFitHere(i,a)}));this.nextMoves=this.nextMoves.concat(i)}else{this.nextMoves=[];var a=this.hits[0].row,n=this.hits[0].col,r=this.hits[1].row,s=this.hits[1].col,o=Math.abs(a-r),c=Math.abs(n-s);if(o>0){if(this.nextMoves=this.nextMoves.concat(this.searchAlongColumn(this.hits[0])),0===this.nextMoves.length)do{var h=Math.round(Math.random()*(this.hits.length-1));this.nextMoves=this.nextMoves.concat(this.searchAlongRow(this.hits[h]))}while(0===this.nextMoves.length)}else if(c>0&&(this.nextMoves=this.nextMoves.concat(this.searchAlongRow(this.hits[0])),0===this.nextMoves.length))do{var l=Math.round(Math.random()*(this.hits.length-1));this.nextMoves=this.nextMoves.concat(this.searchAlongColumn(this.hits[l]))}while(0===this.nextMoves.length)}0===this.nextMoves.length&&console.log("destroy failed to produce new coordinates")}}]),t}(),O=[{constructor:v,size:2},{constructor:g,size:3},{constructor:S,size:3},{constructor:f,size:4},{constructor:b,size:5}];function w(t,e){return Object.assign(e).forEach((function(e){for(var i=e.constructor,a=e.size,n=!1;!n;){var r=Math.round(9*Math.random()),s=Math.round(9*Math.random()),o=Math.round(Math.random()),c=t.checkShipPlacement(r,s,a,o);if(c.validPlacement)c.shipSpaces.map((function(t){var e=t.row,i=t.col;return[[1,0],[-1,0],[0,1],[0,-1]].map((function(t){var a=Object(p.a)(t,2),n=a[0],r=a[1];return{row:e+n,col:i+r}}))})).reduce((function(t,e){return t.concat(e)})).filter((function(e){var i=e.row,a=e.col,n=t.getSpace(i,a);return!!n&&n.onHitCallback})).length||(n=t.tryPlaceShip(r,s,i,o))}})),t}var B=function(){function t(){Object(o.a)(this,t);var e=new y,i=w(new y,O);this.playerBoard=e,this.computerBoard=i,this.currentPlayer=this.human,this.gameState=H,this.humanTurn=!0,this.computerPlayer=new x(e),this.makePlayerMove=this.makePlayerMove.bind(this),this.nextMove=this.nextMove.bind(this)}return Object(c.a)(t,[{key:"changeState",value:function(t){this.gameState=t,this.stateChangedCallback(this)}},{key:"startGame",value:function(){this.computerBoard=w(this.computerBoard,O),this.changeState(E)}},{key:"reset",value:function(){this.playerBoard=new y,this.computerBoard=w(new y,O),this.humanTurn=!0,this.changeState(H)}},{key:"makePlayerMove",value:function(t,e){if(this.humanTurn){if(0===this.computerBoard.getSpace(t,e).hitState){var i=this.computerBoard.recieveAttack(t,e);2===this.computerBoard.getSpace(t,e).hitState&&(this.humanTurn=!1),this.computerBoard=i}this.nextMove()}}},{key:"nextMove",value:function(){var t=this;return this.computerBoard.allShipsSunk()?(console.log("Player wins!"),void this.changeState(I)):this.playerBoard.allShipsSunk()?(console.log("Computer wins!"),void this.changeState(I)):void(this.humanTurn||setTimeout((function(){t.computerPlayer.makeMove()||(t.humanTurn=!0),t.nextMove()}),450))}},{key:"getComputerBoard",value:function(){return this.computerBoard}},{key:"getPlayerBoard",value:function(){return this.playerBoard}}]),t}(),C=i(0);var M=function(t){var e,i=t.hitState,a=t.onSpaceClicked;switch(i){case 4:e="sunk-square";break;case 3:e="ship-square";break;case 1:e="hit-square";break;case 2:e="miss-square";break;default:e="empty-square",t.highlighted&&(t.invalidPlacement?e+=" highlighted-invalid":e+=" highlighted")}return null!==a?Object(C.jsx)("div",{onDrop:t.drop,onDragOver:function(t){return t.preventDefault()},onDragEnter:function(e){e.preventDefault(),t.onDragEnter()},onDragLeave:t.onDragLeave,className:e+" space clickable",onClick:a,opacity:t.opacity}):Object(C.jsx)("div",{onDrop:t.drop,onDragOver:function(t){return t.preventDefault()},onDragEnter:function(e){e.preventDefault(),t.onDragEnter()},onDragLeave:t.onDragLeave,className:e+" space",opacity:t.opacity})},z=["",1,2,3,4,5,6,7,8,9,10,""],P=["A","B","C","D","E","F","G","H","I","J"],R=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var a;return Object(o.a)(this,i),(a=e.call(this,t)).updateBoard=a.updateBoard.bind(Object(h.a)(a)),a.highlightRows=a.highlightRows.bind(Object(h.a)(a)),a.clearHighlighting=a.clearHighlighting.bind(Object(h.a)(a)),a.props.board.updateCallback=a.updateBoard,a.state={board:a.props.board,reveal:a.props.reveal,coordsToHighlight:[]},a}return Object(c.a)(i,[{key:"componentDidUpdate",value:function(t){t.board!==this.props.board&&(this.props.board.updateCallback=this.updateBoard,this.updateBoard(this.props.board),this.setState({coordsToHighlight:[]}))}},{key:"highlightRows",value:function(t,e){var i,a;this.clearHighlighting(),2===this.props.direction?(i=t-this.props.startIndex,a=e):(i=t,a=e-this.props.startIndex);var n=this.state.board.checkShipPlacement(i,a,this.props.shipSize,this.props.direction);this.setState({validPlacement:n.validPlacement,coordsToHighlight:n.shipSpaces})}},{key:"clearHighlighting",value:function(){this.setState({validPlacement:!1,coordsToHighlight:[]})}},{key:"generateRow",value:function(t){var e=this,i=this.props,a=i.onClickCallback,n=i.ship,r=this.state,s=r.validPlacement,o=r.coordsToHighlight,c=r.board,h=c.spaces;return Object(C.jsxs)("div",{className:"row",children:[Object(C.jsx)("p",{className:"grid-label",children:P[t]}),h.slice(t*k,t*k+j).map((function(i,r){var h=e.props.reveal&&c.getSpace(t,r).onHitCallback&&1!==i.hitState&&4!==i.hitState?3:i.hitState,l=n?function(){return e.highlightRows(t,r)}:null,u=0,p=0;2===e.props.direction?u=-e.props.startIndex:p=-e.props.startIndex;var d=n?function(){e.props.drop(t+u,r+p),e.clearHighlighting()}:null,v=o.filter((function(e){return e.row===t&&e.col===r}));return Object(C.jsx)(M,{highlighted:v.length,invalidPlacement:v.length&&!s,hitState:h,row:t,col:r,onDragEnter:l,drop:d||null,onSpaceClicked:a&&0===h?function(){return a(t,r)}:null},t*k+r)})),Object(C.jsx)("p",{className:"grid-label"})]},t)}},{key:"updateBoard",value:function(t){this.setState({board:t})}},{key:"componentWillUnmount",value:function(){var t=Object.assign(this.state.board);t.updateCallback=null,this.setState={board:t,coordsToHighlight:[]}}},{key:"render",value:function(){for(var t=this,e=[],i=0;i<k;i++)e.push(i);return Object(C.jsxs)("div",{className:"board-grid",onMouseMove:this.props.onMouseMove,children:[Object(C.jsx)("p",{style:{fontWeight:"bold"},children:this.props.title}),Object(C.jsx)("div",{className:"row",children:z.map((function(t){return Object(C.jsx)("p",{className:"grid-label",children:t})}))}),e.map((function(e){return t.generateRow(e)}))]})}}]),i}(a.Component),D=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(c.a)(i,[{key:"render",value:function(){for(var t=this,e=[],i=function(i){e.push(Object(C.jsx)("div",{className:"space ship-square",draggable:!0,onDragStart:function(e){t.props.dragStart(i)},onDragEnd:function(e){return t.props.dragEnd()}},i))},a=0;a<this.props.shipSize;a++)i(a);return Object(C.jsx)("div",{style:{display:"flex",justifyContent:"center",flexDirection:this.props.flexDirection,alignItems:"center"},className:"ship-placement",children:Object(C.jsx)("div",{style:{flexDirection:this.props.flexDirection,display:"flex",alignItems:"flex-end"},children:e})})}}]),i}(a.Component);var T=function(t){var e=2===t.direction?"row":"column",i=2===t.direction?"column":"row",a="row"===i?"flex-end":"flex-start",n=Object.keys(t.ships).map((function(e){return t.ships[e].placed?null:Object(C.jsx)("p",{style:{marginLeft:"4px",marginRight:"4px",textOrientation:"mixed",writingMode:2===t.direction?"vertical-rl":"horizontal-tb"},children:e})})),r=Object.keys(t.ships).map((function(e,a){var n=t.ships[e];return n.placed?null:Object(C.jsx)(D,{shipName:e,dragStart:function(i){return t.setCurrentShip(e,i,n.size)},dragEnd:t.dragEnd,shipSize:n.size,flexDirection:i},a)}));return Object(C.jsxs)("div",{children:[Object(C.jsx)("div",{className:"row",style:{justifyContent:"center"},children:Object(C.jsx)("button",{onClick:t.rotate,children:"Rotate Ships"})}),Object(C.jsxs)("div",{className:"ship-placement-container",style:{flexDirection:i,alignItems:"stretch",marginTop:"16px",marginBottom:"16px"},children:[Object(C.jsx)("div",{style:{display:"flex",flexDirection:e,alignItems:"flex-start",justifyContent:"space-around"},children:n}),Object(C.jsx)("div",{style:{display:"flex",flexDirection:e,alignItems:a,justifyContent:"space-around"},children:r})]}),Object(C.jsx)("div",{className:"row",style:{justifyContent:"center"},children:Object(C.jsx)("button",{onClick:t.placeRandomly,children:"Place Ships Randomly"})})]})},H=0,E=1,I=2,N=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var a;Object(o.a)(this,i),(a=e.call(this,t)).onGameStateChanged=a.onGameStateChanged.bind(Object(h.a)(a)),a.rotate=a.rotate.bind(Object(h.a)(a)),a.shipPlaced=a.shipPlaced.bind(Object(h.a)(a)),a.reset=a.reset.bind(Object(h.a)(a)),a.setCurrentShip=a.setCurrentShip.bind(Object(h.a)(a)),a.playerBoardRef=new n.a.createRef;var r=new B;return r.stateChangedCallback=a.onGameStateChanged,a.state={game:r,gameState:r.gameState,currentShip:null,startIndex:null,shipSize:null,direction:2,ships:{"PT Boat":{constructor:v,placed:!1,size:2},Destroyer:{constructor:S,placed:!1,size:3},Submarine:{constructor:g,placed:!1,size:3},Battleship:{constructor:f,placed:!1,size:4},Carrier:{constructor:b,placed:!1,size:5}}},a.floatingShipRef=n.a.createRef(),a}return Object(c.a)(i,[{key:"onGameStateChanged",value:function(t){var e=t.gameState;e===H?this.setState({game:t,gameState:e,currentShip:null,ships:{"PT Boat":{constructor:v,placed:!1,size:2},Destroyer:{constructor:S,placed:!1,size:3},Submarine:{constructor:g,placed:!1,size:3},Battleship:{constructor:f,placed:!1,size:4},Carrier:{constructor:b,placed:!1,size:5}}}):this.setState({gameState:e})}},{key:"setCurrentShip",value:function(t,e,i){""===t?this.setState({currentShip:null,startIndex:null,shipSize:null}):this.state.ships[t].placed||this.setState({currentShip:t,startIndex:e,shipSize:i})}},{key:"rotate",value:function(){2===this.state.direction?this.setState({direction:1}):this.setState({direction:2})}},{key:"shipPlaced",value:function(t){var e=Object.assign(this.state.ships);e[t]={placed:!0},Object.keys(this.state.ships).reduce((function(t,i){return t&&e[i].placed}),!0)?this.setState({ships:e,currentShip:null,gameState:E}):this.setState({ships:e,currentShip:null})}},{key:"reset",value:function(){var t=new B;t.stateChangedCallback=this.onGameStateChanged,this.onGameStateChanged(t)}},{key:"render",value:function(){var t=this,e=this.state,i=e.gameState,a=e.ships,n=e.currentShip,r=e.game,s=e.direction,o=e.startIndex,c=e.shipSize;switch(i){case H:return Object(C.jsxs)("div",{className:"vertical-display",children:[Object(C.jsx)("p",{style:{fontWeight:"bold",fontSize:"40px",marginTop:"12px"},children:"Battleship"}),Object(C.jsx)(R,{ref:this.playerBoardRef,board:r.playerBoard,reveal:!0,ship:n,shipSize:c,startIndex:o,direction:s,drop:function(e,i){n&&(r.playerBoard.tryPlaceShip(e,i,a[n].constructor,s)&&t.shipPlaced(n))}}),Object(C.jsx)("p",{children:"Place all ships to start the game"}),Object(C.jsx)("p",{style:{marginTop:"4px",marginBottom:"4px"},children:"To place ships, click and drag them onto the board"}),Object(C.jsx)(T,{ships:a,direction:s,rotate:this.rotate,dragEnd:this.playerBoardRef.current?this.playerBoardRef.current.clearHighlighting:function(){return null},placeRandomly:function(){var e=Object.keys(a).filter((function(t){return!a[t].placed})).map((function(t){return{constructor:a[t].constructor,size:a[t].size}}));w(r.playerBoard,e),t.setState({ships:{},currentShip:null,gameState:E})},setCurrentShip:this.setCurrentShip})]});case E:return Object(C.jsxs)("div",{className:"main-display",children:[Object(C.jsx)(R,{title:"Your Board",board:r.playerBoard,reveal:!0}),Object(C.jsx)(R,{title:"Opponent Board",onClickCallback:r.makePlayerMove,board:r.computerBoard,reveal:!1})]});case I:return Object(C.jsxs)("div",{children:[Object(C.jsxs)("div",{className:"main-display",children:[Object(C.jsx)(R,{title:"Your Board",board:r.playerBoard,reveal:!0}),Object(C.jsx)(R,{title:"Opponent Board",board:r.computerBoard,reveal:!0})]}),Object(C.jsx)("div",{className:"row",style:{justifyContent:"center"},children:Object(C.jsx)("button",{onClick:this.reset,children:"Play Again?"})})]});default:return console.log("no match for game state: ".concat(i)),null}}}]),i}(a.Component);s.a.render(Object(C.jsx)(n.a.StrictMode,{children:Object(C.jsx)(N,{})}),document.getElementById("root"))}},[[15,1,2]]]);
//# sourceMappingURL=main.2ead63d4.chunk.js.map